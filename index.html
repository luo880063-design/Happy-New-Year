<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover,user-scalable=no" />
  <meta name="theme-color" content="#000000" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Ma+Shan+Zheng&display=swap" rel="stylesheet">

  <title>Happy New Year — To 小瑶</title>

  <style>
    :root{
      --safe-top: env(safe-area-inset-top);
      --safe-bottom: env(safe-area-inset-bottom);
      --safe-left: env(safe-area-inset-left);
      --safe-right: env(safe-area-inset-right);
    }
    html,body{
      margin:0; height:100%;
      overflow:hidden;
      background:#000;
      -webkit-font-smoothing: antialiased;
      text-rendering: geometricPrecision;
      font-family: system-ui,-apple-system,"Segoe UI",Roboto,"PingFang SC","Microsoft YaHei",sans-serif;
    }
    canvas#fx{
      position:fixed; inset:0;
      width:100vw; height:100vh;
      display:block;
      background:
        radial-gradient(1400px 900px at 50% 72%, rgba(44,30,86,.42), rgba(0,0,0,1) 62%),
        radial-gradient(900px 600px at 18% 28%, rgba(255,80,180,.12), transparent 60%),
        radial-gradient(900px 600px at 82% 32%, rgba(120,220,255,.11), transparent 60%),
        radial-gradient(900px 600px at 50% 95%, rgba(255,210,90,.10), transparent 60%);
    }
    .vignette{
      pointer-events:none;
      position:fixed; inset:0;
      mix-blend-mode:screen;
      background:
        radial-gradient(1200px 900px at 50% 55%, rgba(255,255,255,.06), rgba(0,0,0,.82) 74%),
        radial-gradient(900px 600px at 15% 32%, rgba(255,60,180,.11), transparent 62%),
        radial-gradient(900px 600px at 85% 35%, rgba(60,220,255,.11), transparent 62%),
        radial-gradient(900px 600px at 50% 92%, rgba(255,210,90,.08), transparent 60%);
    }
    .halo{
      pointer-events:none;
      position:fixed; inset:0; z-index:8;
      mix-blend-mode:screen;
      opacity:.85;
      background: radial-gradient(
        900px 680px at 50% 55%,
        rgba(255,120,220,.10),
        rgba(120,220,255,.07) 40%,
        rgba(0,0,0,0) 76%
      );
      animation: haloBreath 6.4s ease-in-out infinite;
    }
    @keyframes haloBreath{0%,100%{opacity:.62;}50%{opacity:1;}}

    .overlay{
      position:fixed; inset:0; z-index:20;
      padding:
        calc(4.8vh + var(--safe-top))
        calc(5vw + var(--safe-right))
        calc(5.2vh + var(--safe-bottom))
        calc(5vw + var(--safe-left));
      display:grid; place-items:center;
      pointer-events:none;
      text-align:center;
    }
    .card{
      max-width:min(1120px,94vw);
      width:100%;
      padding:18px 12px;
      border-radius:26px;

      /* 更透：让烟花穿透 */
      background:
        radial-gradient(900px 420px at 50% 18%, rgba(255,255,255,.055), rgba(0,0,0,0) 62%),
        rgba(0,0,0,.038);

      backdrop-filter: blur(5.5px) saturate(175%);
      -webkit-backdrop-filter: blur(5.5px) saturate(175%);

      box-shadow:
        0 18px 60px rgba(0,0,0,.34),
        0 0 58px rgba(255,120,220,.09),
        0 0 58px rgba(120,220,255,.08),
        inset 0 0 0 1px rgba(255,255,255,.13);

      opacity:0;
      transform: translateY(10px) scale(.994);
      transition: opacity 900ms ease, transform 900ms ease;
    }
    .card.show{opacity:1; transform: translateY(0) scale(1);}

    .stroke{
      -webkit-text-stroke: .42px rgba(0,0,0,.30);
      text-shadow:
        0 1px 1px rgba(0,0,0,.35),
        0 4px 18px rgba(0,0,0,.55);
      paint-order: stroke fill;
    }
    .line1{
      font-family:"Great Vibes",cursive;
      font-size:clamp(34px, 8.1vw, 78px);
      margin:0 0 6px;
      color:#fff;
      opacity:0; transform: translateY(10px);
      transition: 760ms ease;
    }
    .line2{
      font-family:"Great Vibes",cursive;
      font-size:clamp(18px, 4.9vw, 38px);
      margin:0 0 8px;
      color:#fff;
      opacity:0; transform: translateY(10px);
      transition: 760ms ease;
    }

    /* 第三段：清晰手写花体 */
    .line3{
      font-family:"Ma Shan Zheng",cursive;
      font-size:clamp(16px, 4.4vw, 30px);
      line-height:1.78;
      letter-spacing:.05em;
      color:#fff;

      -webkit-text-stroke: .55px rgba(0,0,0,.38);
      paint-order: stroke fill;
      text-shadow:
        0 1px 0 rgba(0,0,0,.35),
        0 3px 10px rgba(0,0,0,.55),
        0 0 1px rgba(255,255,255,.12);

      opacity:0; transform: translateY(12px);
      transition: 900ms ease;
    }
  </style>
</head>

<body>
  <canvas id="fx"></canvas>
  <div class="halo"></div>
  <div class="vignette"></div>

  <div class="overlay">
    <div class="card" id="card">
      <div class="line1 stroke" id="l1">Happy New Year</div>
      <div class="line2 stroke" id="l2">— To 小瑶</div>
      <div class="line3" id="l3">
        2025年我做过最正确的决定，就是走进你的生活。谢谢你愿意陪我这个幼稚又笨拙的人。<br>
        我想把往后的每一个岁末年初都留给你，不仅是第一个，还有以后的每一个。
      </div>
    </div>
  </div>

  <script>
    /* =======================================================
       手机端更逼真烟花（自动绽放）
       - 真实火箭：长拖尾渐隐、轻微风摆
       - 爆炸：外圈 + 内核 + 二次闪光
       - 柳絮金雨（最浪漫）/ 环形 / 菊花 混合
       - Bloom 光晕（更像录像）
       - 节奏更慢、更“仰望”
    ======================================================= */

    const canvas = document.getElementById("fx");
    const ctx = canvas.getContext("2d", { alpha:false, desynchronized:true });

    let W=0, H=0;
    const DPR = Math.min(2, window.devicePixelRatio || 1);

    function resize(){
      W = Math.floor(innerWidth);
      H = Math.floor(innerHeight);
      canvas.width  = Math.floor(W * DPR);
      canvas.height = Math.floor(H * DPR);
      canvas.style.width = W + "px";
      canvas.style.height = H + "px";
      ctx.setTransform(DPR,0,0,DPR,0,0);
    }
    addEventListener("resize", resize, {passive:true});
    resize();

    const rand=(a,b)=>a+Math.random()*(b-a);
    const clamp=(v,a,b)=>Math.max(a,Math.min(b,v));
    const hsla=(h,s,l,a)=>`hsla(${h},${s}%,${l}%,${a})`;

    // 整体节奏（越小越慢）
    const SLOW = 0.62;

    // 性能自适应（省电模式/低内存更稳）
    const lowEnd = (navigator.deviceMemory && navigator.deviceMemory <= 3) ||
                   (navigator.connection && navigator.connection.saveData);
    const Q = lowEnd ? 0.82 : 1.0;

    // 浪漫配色：粉/紫/金/青
    function romanticHue(){
      const palettes=[[330,360],[300,330],[40,65],[190,215],[260,290]];
      const p=palettes[(Math.random()*palettes.length)|0];
      return (rand(p[0],p[1]))%360;
    }

    // 背景残影（镜头曝光感）
    function fadeBg(){
      ctx.globalCompositeOperation="source-over";
      ctx.fillStyle="rgba(0,0,0,0.10)";
      ctx.fillRect(0,0,W,H);
    }

    // 柔和 bloom 光晕
    function bloom(x,y,h){
      ctx.globalCompositeOperation="lighter";
      const r = rand(85,160);
      const g = ctx.createRadialGradient(x,y,0,x,y,r);
      g.addColorStop(0, hsla(h,92,78,0.30));
      g.addColorStop(0.42, hsla((h+16)%360,88,70,0.13));
      g.addColorStop(1, "rgba(0,0,0,0)");
      ctx.fillStyle=g;
      ctx.beginPath(); ctx.arc(x,y,r,0,Math.PI*2); ctx.fill();
    }

    // 更丝滑的拖尾（渐变 + 曲线）
    function drawSmoothTrail(points, hue, alpha, w){
      if(points.length < 2) return;
      const p0=points[0], p1=points[points.length-1];
      ctx.globalCompositeOperation="lighter";
      const grad = ctx.createLinearGradient(p0.x,p0.y,p1.x,p1.y);
      grad.addColorStop(0, hsla(hue,88,58,alpha*0.03));
      grad.addColorStop(0.55, hsla(hue,95,66,alpha*0.16));
      grad.addColorStop(1, hsla(hue,100,72,alpha*0.68));
      ctx.strokeStyle=grad;
      ctx.lineCap="round";
      ctx.lineJoin="round";
      ctx.lineWidth=w;

      ctx.beginPath();
      ctx.moveTo(points[0].x, points[0].y);
      for(let i=1;i<points.length-1;i++){
        const cpx=points[i].x, cpy=points[i].y;
        const nx=(points[i].x+points[i+1].x)/2;
        const ny=(points[i].y+points[i+1].y)/2;
        ctx.quadraticCurveTo(cpx,cpy,nx,ny);
      }
      ctx.lineTo(points[points.length-1].x, points[points.length-1].y);
      ctx.stroke();
    }

    const rockets=[];
    const sparks=[];
    const embers=[];

    class Rocket{
      constructor(){
        this.x = rand(W*0.18, W*0.82);
        this.y = H + 24;

        // ✅ 放更高：爆点整体上移
        this.ty = rand(H*0.06, H*0.26);

        this.h  = romanticHue();
        this.vx = rand(-0.35,0.35);
        this.vy = rand(-3.6,-2.8);     // 上升更慢一点更真实
        this.ay = 0.032;               // 重力
        this.t  = 0;
        this.trail=[];
        this.trailMax = Math.floor(92*Q);  // 拖尾更长
        // 模式：柳絮最浪漫，其次菊花，再来环形
        const r = Math.random();
        this.mode = (r < 0.52) ? "willow" : (r < 0.84 ? "chrys" : "ring");
      }
      update(dt){
        this.t += dt;

        // 轻微风摆 + 抖动，让上升更像真实
        this.vx += Math.sin(this.t*0.16)*0.010*dt;
        this.vy += this.ay*dt;

        this.x  += this.vx*dt;
        this.y  += this.vy*dt;

        this.trail.push({x:this.x+rand(-0.18,0.18), y:this.y+rand(-0.18,0.18)});
        if(this.trail.length>this.trailMax) this.trail.shift();

        if(this.y <= this.ty || this.t > 580){
          explode(this.x,this.y,this.h,this.mode);
          return false;
        }
        return true;
      }
      draw(){
        drawSmoothTrail(this.trail, this.h, 1.0, 2.25);
        ctx.globalCompositeOperation="lighter";
        ctx.fillStyle = hsla(this.h,95,78,0.95);
        ctx.beginPath(); ctx.arc(this.x,this.y,2.2,0,Math.PI*2); ctx.fill();
      }
    }

    function typeDrag(type){
      if(type==="willow") return 0.993;
      if(type==="ring")   return 0.989;
      return 0.988;
    }

    class Spark{
      constructor(x,y,hue,spd,ang,size,decay,grav,type="normal"){
        this.x=x; this.y=y;
        this.vx=Math.cos(ang)*spd;
        this.vy=Math.sin(ang)*spd;
        this.ay=grav;
        this.h=(hue+rand(-10,10)+360)%360;
        this.a=1;
        this.decay=decay;
        this.size=size;
        this.type=type;

        this.trail=[];
        this.trailMax = Math.floor((type==="willow"? 92: 58)*Q);
        this.twinkle = Math.random() < (type==="willow" ? 0.18 : 0.30);
      }
      update(dt){
        this.vy += this.ay*dt;
        this.x  += this.vx*dt;
        this.y  += this.vy*dt;

        const drag = Math.pow(typeDrag(this.type), dt);
        this.vx *= drag; this.vy *= drag;

        this.trail.push({x:this.x+rand(-0.12,0.12), y:this.y+rand(-0.12,0.12)});
        if(this.trail.length>this.trailMax) this.trail.shift();

        if(this.twinkle && Math.random()<0.10) this.a *= rand(0.90,0.995);
        this.a -= this.decay*dt;
        return this.a>0.02;
      }
      draw(){
        const w = this.size * (this.type==="willow" ? 1.25 : 1.08);
        drawSmoothTrail(this.trail, this.h, this.a, w);

        ctx.globalCompositeOperation="lighter";
        let a2=this.a;
        if(this.twinkle) a2 *= (0.76+0.24*Math.sin(performance.now()*0.018 + this.x*0.02));
        ctx.fillStyle=hsla(this.h,98,74,a2);
        ctx.beginPath(); ctx.arc(this.x,this.y,this.size,0,Math.PI*2); ctx.fill();
      }
    }

    class Ember{
      constructor(x,y,h){
        this.x=x; this.y=y;
        this.vx=rand(-0.24,0.24);
        this.vy=rand(0.06,0.40);
        this.ay=rand(0.002,0.0042);
        this.h=(h+rand(-8,8)+360)%360;
        this.a=rand(0.32,0.62);
        this.decay=rand(0.0010,0.0027);
        this.r=rand(0.7,1.5);
        this.phase=rand(0,Math.PI*2);
      }
      update(dt){
        this.phase += 0.06*dt;
        this.vx += Math.sin(this.phase)*0.010*dt;
        this.vy += this.ay*dt;
        this.x  += this.vx*dt;
        this.y  += this.vy*dt;
        this.vx *= Math.pow(0.996, dt);
        this.vy *= Math.pow(0.996, dt);
        this.a  -= this.decay*dt;
        return this.a>0.02 && this.y < H+90;
      }
      draw(){
        ctx.globalCompositeOperation="lighter";
        ctx.fillStyle=hsla(this.h,70,66,this.a);
        ctx.beginPath(); ctx.arc(this.x,this.y,this.r,0,Math.PI*2); ctx.fill();
      }
    }

    function explode(x,y,hue,mode){
      bloom(x,y,hue);

      const grav = rand(0.030,0.046);
      const pop = rand(0.0,1.0);

      if(mode==="chrys"){
        // 菊花：外圈强 + 内核细
        const n = Math.floor(rand(120,185)*Q);
        for(let i=0;i<n;i++){
          const a = rand(0,Math.PI*2);
          const sp = rand(1.1,3.4);
          sparks.push(new Spark(x,y,hue,sp,a,rand(0.9,1.9),rand(0.006,0.011),grav,"normal"));
        }
        // 内核更亮
        const core = (hue + rand(15,35))%360;
        const n2 = Math.floor(rand(45,80)*Q);
        for(let i=0;i<n2;i++){
          const a = rand(0,Math.PI*2);
          const sp = rand(0.5,1.8);
          sparks.push(new Spark(x,y,core,sp,a,rand(0.8,1.4),rand(0.010,0.016),grav*0.95,"normal"));
        }
        // 余烬
        for(let i=0;i<Math.floor(rand(55,95)*Q);i++) embers.push(new Ember(x+rand(-26,26),y+rand(-26,26),core));

        // 二次闪光（更真实）
        if(pop < 0.52){
          setTimeout(()=>{
            const h2=(hue+rand(70,150))%360;
            bloom(x,y,h2);
            const n3=Math.floor(rand(35,65)*Q);
            for(let i=0;i<n3;i++){
              const a=rand(0,Math.PI*2);
              const sp=rand(0.6,1.8);
              sparks.push(new Spark(x,y,h2,sp,a,rand(0.8,1.3),rand(0.012,0.018),grav*0.92,"normal"));
            }
          }, rand(620,980));
        }
      }

      if(mode==="ring"){
        // 环形：整齐一圈 + 少量内核
        const n = Math.floor(rand(120,170)*Q);
        const ringSp=rand(1.8,3.1);
        for(let i=0;i<n;i++){
          const a=(i/n)*Math.PI*2 + rand(-0.018,0.018);
          sparks.push(new Spark(x,y,hue,ringSp*rand(0.92,1.08),a,rand(0.9,1.7),rand(0.007,0.012),grav*0.92,"ring"));
        }
        const core=(hue+rand(25,55))%360;
        for(let i=0;i<Math.floor(rand(22,45)*Q);i++){
          const a=rand(0,Math.PI*2);
          const sp=rand(0.4,1.4);
          sparks.push(new Spark(x,y,core,sp,a,rand(0.8,1.2),rand(0.013,0.019),grav*0.95,"normal"));
        }
        for(let i=0;i<Math.floor(rand(35,70)*Q);i++) embers.push(new Ember(x+rand(-30,30),y+rand(-30,30),core));
      }

      if(mode==="willow"){
        // 柳絮金雨：最浪漫、下垂慢、拖尾更长
        const gold = rand(42,58);
        const n = Math.floor(rand(165,245)*Q);
        for(let i=0;i<n;i++){
          const a=rand(0,Math.PI*2);
          const sp=rand(0.85,2.75);
          sparks.push(new Spark(x,y,gold,sp,a,rand(0.95,2.0),rand(0.0038,0.0064),grav*1.22,"willow"));
        }
        for(let i=0;i<Math.floor(rand(90,150)*Q);i++){
          embers.push(new Ember(x+rand(-32,32),y+rand(-32,32),gold));
        }
      }
    }

    // 自动发射：更像真实（慢一点、偶尔双响）
    let last = performance.now();
    let acc = 0;

    function frame(t){
      const rawDt = (t-last)/(1000/60);
      last=t;
      const dt = clamp(rawDt,0.6,1.6) * SLOW;

      fadeBg();

      acc += dt;
      const density = clamp((W*H)/(1280*720),0.85,1.55);
      const launchEvery = 250 / density; // ✅ 更慢更真实

      if(acc > launchEvery){
        acc = 0;
        if(rockets.length < (lowEnd ? 2 : 3)){
          rockets.push(new Rocket());
          // 偶尔双响（浪漫但不吵）
          if(Math.random() < 0.14){
            setTimeout(()=>rockets.push(new Rocket()), rand(700,1200));
          }
        }
      }

      for(let i=rockets.length-1;i>=0;i--){
        const ok=rockets[i].update(dt);
        rockets[i].draw();
        if(!ok) rockets.splice(i,1);
      }
      for(let i=sparks.length-1;i>=0;i--){
        const ok=sparks[i].update(dt);
        sparks[i].draw();
        if(!ok) sparks.splice(i,1);
      }
      for(let i=embers.length-1;i>=0;i--){
        const ok=embers[i].update(dt);
        embers[i].draw();
        if(!ok) embers.splice(i,1);
      }

      requestAnimationFrame(frame);
    }

    ctx.fillStyle="#000"; ctx.fillRect(0,0,W,H);
    requestAnimationFrame(frame);

    // 文案入场（自动）
    const card=document.getElementById("card");
    const l1=document.getElementById("l1");
    const l2=document.getElementById("l2");
    const l3=document.getElementById("l3");
    setTimeout(()=>card.classList.add("show"),260);
    setTimeout(()=>{l1.style.opacity=1;l1.style.transform="translateY(0)";},660);
    setTimeout(()=>{l2.style.opacity=1;l2.style.transform="translateY(0)";},940);
    setTimeout(()=>{l3.style.opacity=1;l3.style.transform="translateY(0)";},1240);
  </script>
</body>
</html>
