<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover,user-scalable=no" />
  <meta name="theme-color" content="#000000" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Ma+Shan+Zheng&display=swap" rel="stylesheet">

  <title>Happy New Year — To 小瑶</title>

  <style>
    :root{
      --safe-top: env(safe-area-inset-top);
      --safe-bottom: env(safe-area-inset-bottom);
      --safe-left: env(safe-area-inset-left);
      --safe-right: env(safe-area-inset-right);
    }
    html,body{
      margin:0;height:100%;
      overflow:hidden;background:#000;
      -webkit-font-smoothing: antialiased;
      text-rendering: geometricPrecision;
      font-family: system-ui,-apple-system,"Segoe UI",Roboto,"PingFang SC","Microsoft YaHei",sans-serif;
    }
    canvas#fx{
      position:fixed;inset:0;width:100vw;height:100vh;display:block;
      background:
        radial-gradient(1400px 900px at 50% 72%, rgba(44,30,86,.42), rgba(0,0,0,1) 62%),
        radial-gradient(900px 600px at 18% 28%, rgba(255,80,180,.12), transparent 60%),
        radial-gradient(900px 600px at 82% 32%, rgba(120,220,255,.11), transparent 60%),
        radial-gradient(900px 600px at 50% 95%, rgba(255,210,90,.10), transparent 60%);
    }
    .vignette{
      pointer-events:none;position:fixed;inset:0;mix-blend-mode:screen;
      background:
        radial-gradient(1200px 900px at 50% 55%, rgba(255,255,255,.06), rgba(0,0,0,.82) 74%),
        radial-gradient(900px 600px at 15% 32%, rgba(255,60,180,.11), transparent 62%),
        radial-gradient(900px 600px at 85% 35%, rgba(60,220,255,.11), transparent 62%),
        radial-gradient(900px 600px at 50% 92%, rgba(255,210,90,.08), transparent 60%);
    }
    .halo{
      pointer-events:none;position:fixed;inset:0;z-index:8;mix-blend-mode:screen;
      opacity:.85;
      background: radial-gradient(900px 680px at 50% 55%,
        rgba(255,120,220,.10), rgba(120,220,255,.07) 40%, rgba(0,0,0,0) 76%);
      animation: haloBreath 6.4s ease-in-out infinite;
    }
    @keyframes haloBreath{0%,100%{opacity:.62;}50%{opacity:1;}}

    .overlay{
      position:fixed;inset:0;z-index:20;
      padding: calc(4.8vh + var(--safe-top)) calc(5vw + var(--safe-right))
               calc(5.2vh + var(--safe-bottom)) calc(5vw + var(--safe-left));
      display:grid;place-items:center;pointer-events:none;text-align:center;
    }
    .card{
      max-width:min(1120px,94vw);width:100%;
      padding:18px 12px;border-radius:26px;
      background:
        radial-gradient(900px 420px at 50% 18%, rgba(255,255,255,.05), rgba(0,0,0,0) 62%),
        rgba(0,0,0,.030);
      backdrop-filter: blur(5.2px) saturate(180%);
      -webkit-backdrop-filter: blur(5.2px) saturate(180%);
      box-shadow:
        0 18px 60px rgba(0,0,0,.34),
        0 0 80px rgba(255,120,220,.10),
        0 0 80px rgba(120,220,255,.09),
        inset 0 0 0 1px rgba(255,255,255,.12);
      opacity:0;transform:translateY(10px) scale(.994);
      transition:opacity 900ms ease, transform 900ms ease;
    }
    .card.show{opacity:1;transform:translateY(0) scale(1);}

    .stroke{
      -webkit-text-stroke:.42px rgba(0,0,0,.30);
      text-shadow:0 1px 1px rgba(0,0,0,.35), 0 4px 18px rgba(0,0,0,.55);
      paint-order:stroke fill;
    }
    .line1{
      font-family:"Great Vibes",cursive;
      font-size:clamp(34px, 8.1vw, 78px);
      margin:0 0 6px;color:#fff;opacity:0;transform:translateY(10px);
      transition:760ms ease;
    }
    .line2{
      font-family:"Great Vibes",cursive;
      font-size:clamp(18px, 4.9vw, 38px);
      margin:0 0 8px;color:#fff;opacity:0;transform:translateY(10px);
      transition:760ms ease;
    }
    .line3{
      font-family:"Ma Shan Zheng",cursive;
      font-size:clamp(16px, 4.4vw, 30px);
      line-height:1.78;letter-spacing:.05em;color:#fff;
      -webkit-text-stroke:.55px rgba(0,0,0,.38);
      paint-order:stroke fill;
      text-shadow:0 1px 0 rgba(0,0,0,.35), 0 3px 10px rgba(0,0,0,.55), 0 0 1px rgba(255,255,255,.12);
      opacity:0;transform:translateY(12px);transition:900ms ease;
    }
  </style>
</head>

<body>
  <canvas id="fx"></canvas>
  <div class="halo"></div>
  <div class="vignette"></div>

  <div class="overlay">
    <div class="card" id="card">
      <div class="line1 stroke" id="l1">Happy New Year</div>
      <div class="line2 stroke" id="l2">— To 小瑶</div>
      <div class="line3" id="l3">
        2025年我做过最正确的决定，就是走进你的生活。谢谢你愿意陪我这个幼稚又笨拙的人。<br>
        我想把往后的每一个岁末年初都留给你，不仅是第一个，还有以后的每一个。
      </div>
    </div>
  </div>

<script>
/* ===========================
   全自动高空绽放（更高 + 更绚烂 + 必爆）
=========================== */
const canvas=document.getElementById("fx");
const ctx=canvas.getContext("2d",{alpha:false,desynchronized:true});

let W=0,H=0;
const DPR=Math.min(2,window.devicePixelRatio||1);
function resize(){
  W=Math.floor(innerWidth);H=Math.floor(innerHeight);
  canvas.width=Math.floor(W*DPR);canvas.height=Math.floor(H*DPR);
  canvas.style.width=W+"px";canvas.style.height=H+"px";
  ctx.setTransform(DPR,0,0,DPR,0,0);
}
addEventListener("resize",resize,{passive:true});resize();

const rand=(a,b)=>a+Math.random()*(b-a);
const clamp=(v,a,b)=>Math.max(a,Math.min(b,v));
const hsla=(h,s,l,a)=>`hsla(${h},${s}%,${l}%,${a})`;

const lowEnd=(navigator.deviceMemory&&navigator.deviceMemory<=3)||(navigator.connection&&navigator.connection.saveData);
const Q=lowEnd?0.80:1.0;

// 节奏：不快但热闹
const SLOW=0.70; // 稍慢
function romanticHue(){
  const palettes=[[330,360],[300,330],[40,65],[190,215],[260,290]];
  const p=palettes[(Math.random()*palettes.length)|0];
  return (rand(p[0],p[1]))%360;
}

function fadeBg(){
  ctx.globalCompositeOperation="source-over";
  ctx.fillStyle="rgba(0,0,0,0.080)";
  ctx.fillRect(0,0,W,H);
}

function bloom(x,y,h){
  ctx.globalCompositeOperation="lighter";
  const r=rand(130,230);
  const g=ctx.createRadialGradient(x,y,0,x,y,r);
  g.addColorStop(0, hsla(h,95,82,0.40));
  g.addColorStop(0.40, hsla((h+14)%360,90,72,0.18));
  g.addColorStop(1,"rgba(0,0,0,0)");
  ctx.fillStyle=g;
  ctx.beginPath();ctx.arc(x,y,r,0,Math.PI*2);ctx.fill();
}

function drawSmoothTrail(points,hue,alpha,w){
  if(points.length<2) return;
  const p0=points[0],p1=points[points.length-1];
  ctx.globalCompositeOperation="lighter";
  const grad=ctx.createLinearGradient(p0.x,p0.y,p1.x,p1.y);
  grad.addColorStop(0, hsla(hue,90,55,alpha*0.02));
  grad.addColorStop(0.55, hsla(hue,96,66,alpha*0.20));
  grad.addColorStop(1, hsla(hue,100,74,alpha*0.82));
  ctx.strokeStyle=grad;
  ctx.lineCap="round";ctx.lineJoin="round";ctx.lineWidth=w;

  ctx.beginPath();
  ctx.moveTo(points[0].x,points[0].y);
  for(let i=1;i<points.length-1;i++){
    const cpx=points[i].x,cpy=points[i].y;
    const nx=(points[i].x+points[i+1].x)/2;
    const ny=(points[i].y+points[i+1].y)/2;
    ctx.quadraticCurveTo(cpx,cpy,nx,ny);
  }
  ctx.lineTo(points[points.length-1].x,points[points.length-1].y);
  ctx.stroke();
}

// ✅ 爆点：强制在“文字框上方”
function burstY(){ return rand(H*0.04, H*0.18); }  // 更高
function launchX(){ return rand(W*0.12, W*0.88); }

const rockets=[],sparks=[],embers=[];

function typeDrag(type){
  if(type==="willow") return 0.993;
  if(type==="ring") return 0.989;
  return 0.988;
}

class Rocket{
  constructor(){
    this.x=launchX();
    this.y=H+30;

    // 目标爆点很高
    this.ty=burstY();

    this.h=romanticHue();

    // ✅ 关键：更强上升动力 + 更小重力
    this.vx=rand(-0.22,0.22);
    this.vy=rand(-6.8,-5.4);     // 让它肯定能上去
    this.ay=0.020;               // 减小重力，避免半路掉下来

    this.t=0;
    this.trail=[];
    this.trailMax=Math.floor(120*Q);

    const r=Math.random();
    this.mode=(r<0.55)?"willow":(r<0.85)?"chrys":"ring";

    this.exploded=false;
  }

  update(dt){
    this.t+=dt;

    // 风摆（很轻）
    this.vx += Math.sin(this.t*0.12)*0.006*dt;
    this.vy += this.ay*dt;

    this.x += this.vx*dt;
    this.y += this.vy*dt;

    this.trail.push({x:this.x+rand(-0.16,0.16), y:this.y+rand(-0.16,0.16)});
    if(this.trail.length>this.trailMax) this.trail.shift();

    // ✅ 必爆逻辑：
    // 1) 达到目标高度爆
    // 2) 或者到达最高点（vy 从负变正）也爆（防止“小点掉下去”）
    const reachedTarget = (this.y <= this.ty);
    const reachedApex   = (this.vy >= 0 && this.y < H*0.55); // 在空中转向就爆
    const timeout       = (this.t > 820);

    if(!this.exploded && (reachedTarget || reachedApex || timeout)){
      this.exploded=true;
      explode(this.x,this.y,this.h,this.mode);
      return false;
    }
    return true;
  }

  draw(){
    drawSmoothTrail(this.trail,this.h,1.0,2.55);
    ctx.globalCompositeOperation="lighter";
    ctx.fillStyle=hsla(this.h,98,82,0.98);
    ctx.beginPath();ctx.arc(this.x,this.y,2.35,0,Math.PI*2);ctx.fill();
  }
}

class Spark{
  constructor(x,y,hue,spd,ang,size,decay,grav,type="normal"){
    this.x=x;this.y=y;
    this.vx=Math.cos(ang)*spd;
    this.vy=Math.sin(ang)*spd;
    this.ay=grav;
    this.h=(hue+rand(-10,10)+360)%360;
    this.a=1;
    this.decay=decay;
    this.size=size;
    this.type=type;

    this.trail=[];
    this.trailMax=Math.floor((type==="willow"?125:90)*Q);
    this.twinkle=Math.random()<(type==="willow"?0.22:0.34);
  }
  update(dt){
    this.vy+=this.ay*dt;
    this.x+=this.vx*dt;
    this.y+=this.vy*dt;

    const drag=Math.pow(typeDrag(this.type),dt);
    this.vx*=drag; this.vy*=drag;

    this.trail.push({x:this.x+rand(-0.12,0.12), y:this.y+rand(-0.12,0.12)});
    if(this.trail.length>this.trailMax) this.trail.shift();

    if(this.twinkle && Math.random()<0.10) this.a*=rand(0.90,0.996);
    this.a-=this.decay*dt;
    return this.a>0.02;
  }
  draw(){
    const w=this.size*(this.type==="willow"?1.28:1.12);
    drawSmoothTrail(this.trail,this.h,this.a,w);

    ctx.globalCompositeOperation="lighter";
    let a2=this.a;
    if(this.twinkle) a2*=(0.75+0.25*Math.sin(performance.now()*0.016+this.x*0.02));
    ctx.fillStyle=hsla(this.h,100,76,a2);
    ctx.beginPath();ctx.arc(this.x,this.y,this.size,0,Math.PI*2);ctx.fill();
  }
}

class Ember{
  constructor(x,y,h){
    this.x=x;this.y=y;
    this.vx=rand(-0.28,0.28);
    this.vy=rand(0.05,0.46);
    this.ay=rand(0.0018,0.0048);
    this.h=(h+rand(-8,8)+360)%360;
    this.a=rand(0.30,0.62);
    this.decay=rand(0.0008,0.0023);
    this.r=rand(0.8,1.8);
    this.phase=rand(0,Math.PI*2);
  }
  update(dt){
    this.phase+=0.06*dt;
    this.vx+=Math.sin(this.phase)*0.010*dt;
    this.vy+=this.ay*dt;
    this.x+=this.vx*dt;
    this.y+=this.vy*dt;
    this.vx*=Math.pow(0.996,dt);
    this.vy*=Math.pow(0.996,dt);
    this.a-=this.decay*dt;
    return this.a>0.02 && this.y<H+140;
  }
  draw(){
    ctx.globalCompositeOperation="lighter";
    ctx.fillStyle=hsla(this.h,70,66,this.a);
    ctx.beginPath();ctx.arc(this.x,this.y,this.r,0,Math.PI*2);ctx.fill();
  }
}

function explode(x,y,hue,mode){
  bloom(x,y,hue);
  const grav=rand(0.026,0.042);
  const pop=Math.random();

  if(mode==="chrys"){
    // 外圈更绚烂
    const n=Math.floor(rand(190,280)*Q);
    for(let i=0;i<n;i++){
      const a=rand(0,Math.PI*2);
      const sp=rand(1.4,4.6);
      sparks.push(new Spark(x,y,hue,sp,a,rand(1.0,2.2),rand(0.006,0.010),grav,"normal"));
    }
    // 内核更亮
    const core=(hue+rand(15,45))%360;
    const n2=Math.floor(rand(80,140)*Q);
    for(let i=0;i<n2;i++){
      const a=rand(0,Math.PI*2);
      const sp=rand(0.6,2.4);
      sparks.push(new Spark(x,y,core,sp,a,rand(0.9,1.6),rand(0.010,0.016),grav*0.95,"normal"));
    }
    for(let i=0;i<Math.floor(rand(90,150)*Q);i++){
      embers.push(new Ember(x+rand(-34,34),y+rand(-34,34),core));
    }
    // 二次闪更像真烟花
    if(pop<0.70){
      setTimeout(()=>{
        const h2=(hue+rand(70,160))%360;
        bloom(x,y,h2);
        const n3=Math.floor(rand(70,120)*Q);
        for(let i=0;i<n3;i++){
          const a=rand(0,Math.PI*2);
          const sp=rand(0.7,2.3);
          sparks.push(new Spark(x,y,h2,sp,a,rand(0.9,1.5),rand(0.012,0.018),grav*0.92,"normal"));
        }
      }, rand(520,820));
    }
  }

  if(mode==="ring"){
    const n=Math.floor(rand(200,290)*Q);
    const ringSp=rand(2.2,3.9);
    for(let i=0;i<n;i++){
      const a=(i/n)*Math.PI*2 + rand(-0.018,0.018);
      sparks.push(new Spark(x,y,hue,ringSp*rand(0.92,1.08),a,rand(1.0,2.0),rand(0.007,0.012),grav*0.92,"ring"));
    }
    const core=(hue+rand(25,60))%360;
    for(let i=0;i<Math.floor(rand(45,90)*Q);i++){
      const a=rand(0,Math.PI*2);
      const sp=rand(0.5,1.8);
      sparks.push(new Spark(x,y,core,sp,a,rand(0.9,1.4),rand(0.013,0.019),grav*0.95,"normal"));
    }
    for(let i=0;i<Math.floor(rand(70,120)*Q);i++){
      embers.push(new Ember(x+rand(-38,38),y+rand(-38,38),core));
    }
  }

  if(mode==="willow"){
    // 柳絮金雨：最浪漫、下垂明显
    const gold=rand(42,58);
    const n=Math.floor(rand(240,360)*Q);
    for(let i=0;i<n;i++){
      const a=rand(0,Math.PI*2);
      const sp=rand(1.0,3.3);
      sparks.push(new Spark(x,y,gold,sp,a,rand(1.0,2.3),rand(0.0034,0.0056),grav*1.25,"willow"));
    }
    for(let i=0;i<Math.floor(rand(140,240)*Q);i++){
      embers.push(new Ember(x+rand(-40,40),y+rand(-40,40),gold));
    }
    setTimeout(()=>{
      const h2=romanticHue();
      bloom(x,y,h2);
      const n2=Math.floor(rand(45,85)*Q);
      for(let i=0;i<n2;i++){
        const a=rand(0,Math.PI*2);
        const sp=rand(0.6,1.9);
        sparks.push(new Spark(x,y,h2,sp,a,rand(0.9,1.5),rand(0.012,0.018),grav*0.92,"normal"));
      }
    }, rand(520,780));
  }
}

// ========= 全自动发射（更频繁 + 双发） =========
let last=performance.now(), acc=0;

function frame(t){
  const rawDt=(t-last)/(1000/60);
  last=t;
  const dt=clamp(rawDt,0.6,1.8)*SLOW;

  fadeBg();

  acc+=dt;
  const density=clamp((W*H)/(1280*720),0.85,1.55);
  const launchEvery = 120 / density; // 更频繁

  if(acc>launchEvery){
    acc=0;
    const shots = (Math.random()<0.55) ? 2 : 1; // 更常见双发
    for(let s=0;s<shots;s++){
      if(rockets.length < (lowEnd ? 4 : 6)){
        rockets.push(new Rocket());
      }
    }
  }

  for(let i=rockets.length-1;i>=0;i--){
    const ok=rockets[i].update(dt);
    rockets[i].draw();
    if(!ok) rockets.splice(i,1);
  }
  for(let i=sparks.length-1;i>=0;i--){
    const ok=sparks[i].update(dt);
    sparks[i].draw();
    if(!ok) sparks.splice(i,1);
  }
  for(let i=embers.length-1;i>=0;i--){
    const ok=embers[i].update(dt);
    embers[i].draw();
    if(!ok) embers.splice(i,1);
  }

  requestAnimationFrame(frame);
}

ctx.fillStyle="#000"; ctx.fillRect(0,0,W,H);
requestAnimationFrame(frame);

// 文案入场
const card=document.getElementById("card");
const l1=document.getElementById("l1");
const l2=document.getElementById("l2");
const l3=document.getElementById("l3");
setTimeout(()=>card.classList.add("show"),240);
setTimeout(()=>{l1.style.opacity=1;l1.style.transform="translateY(0)";},620);
setTimeout(()=>{l2.style.opacity=1;l2.style.transform="translateY(0)";},900);
setTimeout(()=>{l3.style.opacity=1;l3.style.transform="translateY(0)";},1200);
</script>
</body>
</html>
